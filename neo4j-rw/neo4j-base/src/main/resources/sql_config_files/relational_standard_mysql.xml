<?xml version="1.0" encoding="utf-8"?>

<sql>
    <getDapStandardBasic   type="NODE" workName="同步基础标准" seq="1" nodeName="基础标准" label="model.dap.dapStandardEntity" columns="standardId,guid,topicName,firstCategory,secondCategory,thirdCategory,moiDisplayName,moiName,standardType,updateTime,departmentName,businessDefine,dataType,sourceCode,dataLength,dataScale,valueRange,referRules,publishTime,createTime,updateBy,createBy,assetStatus,assetStatusOperator,assetStatusOperatorTime">
        <![CDATA[
         select a.id as standardId ,
            CONCAT('${param.systemId}',';','${param.env}',';','标准',';','${param.importName}',';',a.id) as guid,
            (select code_name from dap_system_category where id = a.topic_id limit 1) as topicName,
            (select code_name from dap_system_category where id = a.first_category limit 1) as firstCategory,
            (select code_name from dap_system_category where id = a.second_category limit 1) as secondCategory,
            (select code_name from dap_system_category where id = a.third_category limit 1) as thirdCategory,
            a.name as moiDisplayName,
            a.eng_name as moiName,
            0 as standardType,
            DATE_FORMAT(a.update_time,'%Y%m%d%H%i%s') AS updateTime,
            b.depart_name as departmentName,
            a.business_define as businessDefine,
            a.data_type as dataType,
            a.source_code as sourceCode,
            a.data_length as dataLength,
            a.data_scale as dataScale,
            a.value_range as valueRange,
            a.refer_rules as referRules,
            DATE_FORMAT(a.publish_time,'%Y%m%d%H%i%s') AS publishTime,
            DATE_FORMAT(a.create_time,'%Y%m%d%H%i%s') AS createTime,
            a.create_by as createBy,
            a.update_by as updateBy,
            1 as assetStatus,
            'bd-metadata-sync-executor' as assetStatusOperator,
            DATE_FORMAT(now(),'%Y%m%d%H%i%s') AS assetStatusOperatorTime
        from dap_standard_basic a
        left join dap_system_department b on a.department_id = b.id
        where a.bm_status = 1
        and a.publish_newest = 1
        order by a.publish_time desc
        ]]>
    </getDapStandardBasic>

    <getDapStandardIndex   type="NODE" workName="同步指标标准" seq="2" nodeName="指标标准" label="model.dap.dapStandardEntity" columns="standardId,guid,topicName,firstCategory,secondCategory,thirdCategory,systemName,moiDisplayName,moiName,standardType,updateTime,bizLineId,indexCode,businessDefine,indexUsage,dataWarehouseModel,departmentName,dataSourceSystem,dataWarehouseMakeLogic,businessPersonnel,dataAnalyst,dataWarehouseDeveloper,commonUnits,indexFormat,dateLength,valueRange,indexAppName,indexBizDesc,dataAccuracy,associationDimensionNames,indexType,publishTime,createTime,createBy,updateBy,assetStatus,assetStatusOperator,assetStatusOperatorTime">
        <![CDATA[
           select
										a.id as standardId,
                    CONCAT('${param.systemId}',';','${param.env}',';','标准',';','${param.importName}',';',a.id) as guid,
                   (select code_name from dap_system_category where id = a.theme limit 1) as topicName,
                   (select code_name from dap_system_category where id = a.primary_sort limit 1) as firstCategory,
                   (select code_name from dap_system_category where id = a.secondary_sort limit 1) as secondCategory,
                   (select code_name from dap_system_category where id = a.third_sort limit 1) as thirdCategory,
                   (select `name` from dap_system_info where id = a.data_source_system) as systemName,
                   a.index_chin_name    as moiDisplayName,
                   a.index_eng_name     as moiName,
                      1         as standardType,
									 DATE_FORMAT(a.update_time,'%Y%m%d%H%i%s') AS updateTime,
									 a.biz_line_id as bizLineId,
									 a.index_code as indexCode,
									 a.business_definition as businessDefine,
									 a.index_usage as indexUsage,
									 a.data_warehouse_model as dataWarehouseModel,
									 b.depart_name as departmentName,
									 a.data_source_system as dataSourceSystem,
									 a.data_warehouse_make_logic as dataWarehouseMakeLogic,
									 a.business_personnel as businessPersonnel,
									 a.data_analyst as dataAnalyst,
									 a.data_warehouse_developer as dataWarehouseDeveloper,
									 a.common_units as commonUnits,
									 a.index_format as indexFormat,
									 a.date_length as dateLength,
									 a.value_range as valueRange,
									 a.index_app_name as indexAppName,
									 a.index_biz_desc as indexBizDesc,
									 a.data_accuracy as dataAccuracy,
									 a.association_dimension as associationDimensionNames,
									 a.index_type as indexType,
									DATE_FORMAT(a.publish_time,'%Y%m%d%H%i%s') AS publishTime,
									DATE_FORMAT(a.create_time,'%Y%m%d%H%i%s') AS createTime,
									a.create_by as createBy,
									a.update_by as updateBy,
									1 as assetStatus,
                                    'bd-metadata-sync-executor' as assetStatusOperator,
                                    DATE_FORMAT(now(),'%Y%m%d%H%i%s') AS assetStatusOperatorTime
            from dap_standard_index a left join dap_system_department b on a.management_department_id = b.id
            where a.bm_status = 1
              and a.publish_newest = 1
            order by a.publish_time desc
        ]]>
    </getDapStandardIndex>


    <getDapStandardFolderEntityToBasicDapStandardEntity  type="RELATIONSHIP" workName="同步指标文件夹->基础标准" seq="3" label="model.dap.dapStandardFolderToDapStandardEntity" srcLabel="model.dap.dapStandardFolderEntity" targetLabel="model.dap.dapStandardEntity">
        select
            CONCAT('${param.systemId}',';','${param.env}',';','标准',';','${param.importName}') as sourceGuid,
            CONCAT('${param.systemId}',';','${param.env}',';','标准',';','${param.importName}',';',a.id) as targetGuid
        from dap_standard_basic a
            where a.bm_status = 1
        and a.publish_newest = 1
        order by a.publish_time desc
    </getDapStandardFolderEntityToBasicDapStandardEntity>


    <getDapStandardFolderEntityToIndexDapStandardEntity  type="RELATIONSHIP" workName="同步指标文件夹->指标标准" seq="3" label="model.dap.dapStandardFolderToDapStandardEntity" srcLabel="model.dap.dapStandardFolderEntity" targetLabel="model.dap.dapStandardEntity">
        select
        CONCAT('${param.systemId}',';','${param.env}',';','标准',';','${param.importName}') as sourceGuid,
        CONCAT('${param.systemId}',';','${param.env}',';','标准',';','${param.importName}',';',a.id) as targetGuid
        from dap_standard_index a
        where a.bm_status = 1
        and a.publish_newest = 1
        order by a.publish_time desc
    </getDapStandardFolderEntityToIndexDapStandardEntity>



</sql>